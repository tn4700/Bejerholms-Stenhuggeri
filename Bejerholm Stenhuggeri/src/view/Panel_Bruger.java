/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package view;

import control.DBConnection;
import control.DatabaseObjectHandler;
import java.awt.Component;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import model.User;

/**
 *
 * @author T
 */
public class Panel_Bruger extends javax.swing.JPanel {

    private DatabaseObjectHandler dbhandler;
    private DBConnection db;
    private User user;
    private ArrayList<User> userlist;
    User valgtebruger;

    /**
     * Creates new form Panel_Bruger
     */
    public Panel_Bruger(DBConnection db) {
        this.db = db;
        dbhandler = new DatabaseObjectHandler(db);
        initComponents();
        // fiktiv ham der er logget ind
        user = new User("Mathias Bejerholm", "123");
        try {
            //      
            userlist = dbhandler.getUserList();
        } catch (SQLException ex) {
            System.out.println("Der kunne ikke henstes brugere" + ex);
        }

        for (int i = 0; i < userlist.size(); i++) {
            jComboBox_Brugere.addItem(userlist.get(i));
        }
        if (user.getUsername().equals("Mathias Bejerholm")) {
            jTextField_brugerKode2.setVisible(false);
            jTextField_brugerKodeNu.setVisible(false);
            jButton_Rediger2.setVisible(false);
        } else {
            jComboBox_Brugere.setVisible(false);
            jButton_Hent.setVisible(false);
            jButton_Rediger.setVisible(false);
            jButton_Slet.setVisible(false);
            jTextField_brugerKode.setVisible(false);
            jTextField_brugerNavn.setVisible(false);
        }
        jLabel_brugerNavn.setText("Goddag " + user);

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jComboBox_Brugere = new javax.swing.JComboBox();
        jTextField_brugerNavn = new javax.swing.JTextField();
        jTextField_brugerKode = new javax.swing.JTextField();
        jButton_Hent = new javax.swing.JButton();
        jButton_Rediger = new javax.swing.JButton();
        jButton_Slet = new javax.swing.JButton();
        jLabel_brugerNavn = new javax.swing.JLabel();
        jTextField_brugerKode2 = new javax.swing.JTextField();
        jButton_Rediger2 = new javax.swing.JButton();
        jTextField_brugerKodeNu = new javax.swing.JTextField();
        jLabel_brugerinfo = new javax.swing.JLabel();

        setPreferredSize(new java.awt.Dimension(800, 500));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jComboBox_Brugere.addContainerListener(new java.awt.event.ContainerAdapter() {
            public void componentRemoved(java.awt.event.ContainerEvent evt) {
                jComboBox_BrugereComponentRemoved(evt);
            }
        });
        jComboBox_Brugere.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox_BrugereActionPerformed(evt);
            }
        });
        add(jComboBox_Brugere, new org.netbeans.lib.awtextra.AbsoluteConstraints(430, 40, 160, -1));

        jTextField_brugerNavn.setText("Bruger Navn");
        jTextField_brugerNavn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_brugerNavnActionPerformed(evt);
            }
        });
        add(jTextField_brugerNavn, new org.netbeans.lib.awtextra.AbsoluteConstraints(615, 92, 135, -1));

        jTextField_brugerKode.setText("Kode");
        add(jTextField_brugerKode, new org.netbeans.lib.awtextra.AbsoluteConstraints(615, 126, 135, -1));

        jButton_Hent.setText("Hent Bruger");
        jButton_Hent.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_HentActionPerformed(evt);
            }
        });
        add(jButton_Hent, new org.netbeans.lib.awtextra.AbsoluteConstraints(640, 40, 100, -1));

        jButton_Rediger.setText("Ret!");
        jButton_Rediger.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_RedigerActionPerformed(evt);
            }
        });
        add(jButton_Rediger, new org.netbeans.lib.awtextra.AbsoluteConstraints(540, 220, 110, -1));

        jButton_Slet.setText("Slet Bruger");
        jButton_Slet.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_SletActionPerformed(evt);
            }
        });
        add(jButton_Slet, new org.netbeans.lib.awtextra.AbsoluteConstraints(670, 220, 100, -1));

        jLabel_brugerNavn.setFont(new java.awt.Font("sansserif", 0, 18)); // NOI18N
        jLabel_brugerNavn.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel_brugerNavn.setText("[Navn]");
        add(jLabel_brugerNavn, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 50, 360, 60));

        jTextField_brugerKode2.setText("[Ny kode]");
        jTextField_brugerKode2.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                jTextField_brugerKode2MousePressed(evt);
            }
        });
        jTextField_brugerKode2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField_brugerKode2ActionPerformed(evt);
            }
        });
        add(jTextField_brugerKode2, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 170, 150, -1));

        jButton_Rediger2.setText("Ret Kode!");
        jButton_Rediger2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton_Rediger2ActionPerformed(evt);
            }
        });
        add(jButton_Rediger2, new org.netbeans.lib.awtextra.AbsoluteConstraints(270, 220, 110, 30));

        jTextField_brugerKodeNu.setText("[Nuværende Kode]");
        jTextField_brugerKodeNu.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                jTextField_brugerKodeNuMousePressed(evt);
            }
        });
        add(jTextField_brugerKodeNu, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 130, 150, -1));

        jLabel_brugerinfo.setFont(new java.awt.Font("sansserif", 0, 18)); // NOI18N
        jLabel_brugerinfo.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel_brugerinfo.setText("test");
        add(jLabel_brugerinfo, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 320, 490, 110));
    }// </editor-fold>//GEN-END:initComponents

    private void jComboBox_BrugereActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox_BrugereActionPerformed
    }//GEN-LAST:event_jComboBox_BrugereActionPerformed

    private void jTextField_brugerNavnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_brugerNavnActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_brugerNavnActionPerformed

    private void jButton_HentActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_HentActionPerformed
        valgtebruger = (User) jComboBox_Brugere.getSelectedItem();
        jTextField_brugerNavn.setText(valgtebruger.getUsername());
    }//GEN-LAST:event_jButton_HentActionPerformed

    private void jButton_SletActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_SletActionPerformed
        try {
            if (valgtebruger.getUsername().equals("Mahias BejerHolm")) {
                jLabel_brugerinfo.setText("<html><div style=\"text-align: center;\"> <font color='red'>Advarsel!</front><br>Brugernavnet på admin kan ikke rettes på systemmet.</html>");
            } else {
                dbhandler.deleteUser(valgtebruger);
                jLabel_brugerinfo.setText("<html><div style=\"text-align: center;\"> <font color='green'>Success!</font> <br>Brugeren er slettet fra systemmet. </html>" + jTextField_brugerNavn.getText());
            }
        } catch (Exception e) {
            System.out.println("fejl ved seltbutton" + e);
            JOptionPane.showMessageDialog(null,
                    "Der opstod en fejl ved sletning af en bruger\nHusk at 'Hent Bruger' før du sletter/retter.",
                    "Hov! Beklager fejlen",
                    JOptionPane.ERROR_MESSAGE);
        }

    }//GEN-LAST:event_jButton_SletActionPerformed

    private void jButton_RedigerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_RedigerActionPerformed
        try {
            if (valgtebruger.getUsername().equals("Bejerholm")) {
                jLabel_brugerinfo.setText("<html><div style=\"text-align: center;\"> <font color='red'>Advarsel!</front><br>Brugernavnet på admin kan ikke rettes på systemmet.</html>");

            } else {
                valgtebruger.setPassword(jTextField_brugerKode.getText());
                dbhandler.editUser(valgtebruger);
                jLabel_brugerinfo.setText("<html><div style=\"text-align: center;\"> <font color='green'>Godkendt!</font> <br>Koderen er nu ændret.</html>");
            }
        } catch (Exception e) {
            System.out.println("fejl ved retbuttonadmin" + e);
            JOptionPane.showMessageDialog(null,
                    "Der opstod en fejl ved redigering af en bruger\nHusk at 'Hent Bruger' før du sletter/retter.",
                    "Hov! Beklager fejlen",
                    JOptionPane.ERROR_MESSAGE);
        }

    }//GEN-LAST:event_jButton_RedigerActionPerformed

    private void jButton_Rediger2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton_Rediger2ActionPerformed
        try {
            if (user.getPassword().equals(jTextField_brugerKodeNu.getText()) && !user.getPassword().equals(jTextField_brugerKode2.getText())) {
                user.setPassword(jTextField_brugerKode2.getText());
                dbhandler.editUser(user);
                System.out.println("jeg har rettet kodefelt 2");
                jLabel_brugerinfo.setText("<html><div style=\"text-align: center;\"> <font color='green'>Success!</font> <br>Koderen er nu ændret.</html>");
            } else {
                jLabel_brugerinfo.setText("<html><div style=\"text-align: center;\"> <font color='red'>Mislykkedes!</font> <br>Der opstod en fejl ved ændring af kode.<br>Kontroller evt. nuværende kode og sørg for du ikke ændre til din gamle kode.</html>");

            }
        } catch (Exception e) {
            System.out.println("feg" + e);
        }
    }//GEN-LAST:event_jButton_Rediger2ActionPerformed

    private void jTextField_brugerKode2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jTextField_brugerKode2ActionPerformed
    }//GEN-LAST:event_jTextField_brugerKode2ActionPerformed

    private void jTextField_brugerKodeNuMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTextField_brugerKodeNuMousePressed
        jTextField_brugerKodeNu.setText("");        // TODO add your handling code here:
    }//GEN-LAST:event_jTextField_brugerKodeNuMousePressed

    private void jTextField_brugerKode2MousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTextField_brugerKode2MousePressed
        jTextField_brugerKode2.setText("");
    }//GEN-LAST:event_jTextField_brugerKode2MousePressed

    private void jComboBox_BrugereComponentRemoved(java.awt.event.ContainerEvent evt) {//GEN-FIRST:event_jComboBox_BrugereComponentRemoved
        // TODO add your handling code here:
    }//GEN-LAST:event_jComboBox_BrugereComponentRemoved
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton_Hent;
    private javax.swing.JButton jButton_Rediger;
    private javax.swing.JButton jButton_Rediger2;
    private javax.swing.JButton jButton_Slet;
    private javax.swing.JComboBox jComboBox_Brugere;
    private javax.swing.JLabel jLabel_brugerNavn;
    private javax.swing.JLabel jLabel_brugerinfo;
    private javax.swing.JTextField jTextField_brugerKode;
    private javax.swing.JTextField jTextField_brugerKode2;
    private javax.swing.JTextField jTextField_brugerKodeNu;
    private javax.swing.JTextField jTextField_brugerNavn;
    // End of variables declaration//GEN-END:variables
}
